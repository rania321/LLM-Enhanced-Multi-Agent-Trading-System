<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Dashboard - LLM Trading System</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body class="dashboard-body">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                </svg>
                <span>Trading AI</span>
            </div>
        </div>

        <nav class="sidebar-nav">
            <a href="#" class="nav-item active">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <rect x="3" y="3" width="7" height="7"/>
                    <rect x="14" y="3" width="7" height="7"/>
                    <rect x="14" y="14" width="7" height="7"/>
                    <rect x="3" y="14" width="7" height="7"/>
                </svg>
                <span>Dashboard</span>
            </a>
            
            <a href="#" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M3 3v18h18"/>
                    <path d="M18 17l-4-4-4 4-4-4"/>
                </svg>
                <span>Analytics</span>
            </a>
            
            <a href="/" class="nav-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                </svg>
                <span>Home</span>
            </a>
        </nav>
    </aside>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <header class="topbar">
            <h1 class="page-title">Live Trading Simulation</h1>
            <div class="topbar-actions">
                <div class="status-badge" id="statusBadge">
                    <span class="status-dot"></span>
                    <span>Ready</span>
                </div>
                <button class="btn-primary" id="startBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <polygon points="5 3 19 12 5 21 5 3"/>
                    </svg>
                    Start Simulation
                </button>
            </div>
        </header>

        <!-- Progress Bar -->
        <div class="progress-container" id="progressContainer" style="display: none;">
            <div class="progress-bar" id="progressBar"></div>
            <span class="progress-text" id="progressText">Step 0 / 30</span>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Market Chart -->
            <div class="card card-large">
                <div class="card-header">
                    <h3>Market Price Chart</h3>
                    <div class="chart-controls">
                        <button class="btn-icon" id="pauseBtn" title="Pause">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <rect x="6" y="4" width="4" height="16"/>
                                <rect x="14" y="4" width="4" height="16"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <canvas id="priceChart"></canvas>
                </div>
            </div>

            <!-- Market News -->
            <div class="card">
                <div class="card-header">
                    <h3>Market News</h3>
                    <span class="badge" id="sentimentBadge">Neutral</span>
                </div>
                <div class="card-body">
                    <div class="news-item">
                        <div class="news-icon" id="newsIcon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M12 16v-4M12 8h.01"/>
                            </svg>
                        </div>
                        <p id="newsText">Waiting for market data...</p>
                    </div>
                </div>
            </div>

            <!-- Portfolio Stats -->
            <div class="card">
                <div class="card-header">
                    <h3>Portfolio Performance</h3>
                </div>
                <div class="card-body">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-label">Best Performer</span>
                            <span class="stat-value" id="bestAgent">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Worst Performer</span>
                            <span class="stat-value" id="worstAgent">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">LLM Fund Value</span>
                            <span class="stat-value" id="llmValue">$1000</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Market Price</span>
                            <span class="stat-value" id="currentPrice">$100</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agent Activity -->
            <div class="card card-wide">
                <div class="card-header">
                    <h3>Trading Agents Activity</h3>
                </div>
                <div class="card-body">
                    <div class="agents-list" id="agentsList">
                        <p class="text-muted">Waiting for simulation to start...</p>
                    </div>
                </div>
            </div>

            <!-- LLM Pipeline Visualization -->
            <div class="card card-full">
                <div class="card-header">
                    <h3>LLM Decision Pipeline</h3>
                </div>
                <div class="card-body">
                    <div class="pipeline-flow">
                        <!-- Research Phase -->
                        <div class="pipeline-step">
                            <div class="step-header">
                                <span class="step-number">1</span>
                                <h4>Research Phase</h4>
                            </div>
                            <div class="research-grid">
                                <div class="research-box bullish-box">
                                    <h5>üìà Bullish Evidence</h5>
                                    <pre id="bullishEvidence">Waiting...</pre>
                                </div>
                                <div class="research-box bearish-box">
                                    <h5>üìâ Bearish Evidence</h5>
                                    <pre id="bearishEvidence">Waiting...</pre>
                                </div>
                                <!-- Added GeneralResearchAgent display -->
                                <div class="research-box general-box">
                                    <h5>üîç General Market Analysis</h5>
                                    <div class="general-stance" id="generalStance">
                                        <span class="stance-badge">NEUTRAL</span>
                                    </div>
                                    <pre id="generalEvidence">Waiting...</pre>
                                </div>
                            </div>
                        </div>

                        <div class="pipeline-arrow">‚Üì</div>

                        <!-- Trading Proposal -->
                        <div class="pipeline-step">
                            <div class="step-header">
                                <span class="step-number">2</span>
                                <h4>LLM Trading Proposal</h4>
                            </div>
                            <div class="proposal-box" id="proposalBox">
                                <p>Waiting for proposal...</p>
                            </div>
                        </div>

                        <div class="pipeline-arrow">‚Üì</div>

                        <!-- Risk Assessment -->
                        <div class="pipeline-step">
                            <div class="step-header">
                                <span class="step-number">3</span>
                                <h4>Risk Committee Review</h4>
                            </div>
                            <div class="risk-grid" id="riskGrid">
                                <p>Waiting for risk assessment...</p>
                            </div>
                        </div>

                        <div class="pipeline-arrow">‚Üì</div>

                        <!-- Final Decision -->
                        <div class="pipeline-step">
                            <div class="step-header">
                                <span class="step-number">4</span>
                                <h4>Manager Final Decision</h4>
                            </div>
                            <div class="decision-box" id="decisionBox">
                                <p>Waiting for decision...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Simulation History -->
            <div class="card card-full" id="historyCard" style="display: none;">
                <div class="card-header">
                    <h3>Simulation History</h3>
                    <button class="btn-secondary" id="exportHistoryBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="18" height="18">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Export History
                    </button>
                </div>
                <div class="card-body">
                    <div class="history-controls">
                        <input type="text" id="historySearch" placeholder="Search history..." class="search-input">
                        <select id="historyFilter" class="filter-select">
                            <option value="all">All Steps</option>
                            <option value="trades">Trades Only</option>
                            <option value="llm">LLM Decisions</option>
                            <option value="approved">Approved Trades</option>
                        </select>
                    </div>
                    <div class="history-timeline" id="historyTimeline">
                        <p class="text-muted">Simulation history will appear here after completion...</p>
                    </div>
                </div>
            </div>

            <!-- Analytics Tabs -->
            <div class="card card-large">
                <div class="card-header">
                    <h3>Advanced Analytics</h3>
                    <div class="tabs">
                        <button class="tab active" data-tab="comparison">Agent Comparison</button>
                        <button class="tab" data-tab="actions">Action Distribution</button>
                        <button class="tab" data-tab="performance">Performance History</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="tab-content active" id="comparisonTab">
                        <canvas id="comparisonChart"></canvas>
                    </div>
                    <div class="tab-content" id="actionsTab">
                        <canvas id="actionsChart"></canvas>
                    </div>
                    <div class="tab-content" id="performanceTab">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Added individual trader history cards -->
            <div class="card card-full" id="traderHistoryCard" style="display: none;">
                <div class="card-header">
                    <h3>Individual Trader Performance History</h3>
                    <button class="btn-secondary" id="exportTradersBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" width="18" height="18">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Export Trader Data
                    </button>
                </div>
                <div class="card-body">
                    <div class="trader-tabs" id="traderTabs">
                        <!-- Trader tabs will be generated here -->
                    </div>
                    <div class="trader-history-content" id="traderHistoryContent">
                        <!-- Trader history will be displayed here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/dashboard.js"></script>
</body>
</html>
